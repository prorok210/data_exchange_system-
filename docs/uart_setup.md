# Настройка и работа с UART для MAVLink

Данный документ описывает конфигурацию и работу с UART интерфейсом для обмена сообщениями MAVLink между устройствами системы.

## Параметры UART

| Параметр | Значение | Примечание |
|----------|----------|------------|
| Порт | UART_NUM_0 | Стандартный UART порт на ESP32 |
| Скорость передачи | 115200 | Скорость (bauds) |
| Биты данных | 8 | Стандартное значение |
| Четность | Нет | Без проверки четности |
| Стоп-биты | 1 | Стандартное значение |
| Управление потоком | Нет | - |
| TX Pin | GPIO 1 | Можно настроить в uart_handler.h |
| RX Pin | GPIO 3 | Можно настроить в uart_handler.h |
| Размер буфера | 1024 байт | Для данных отправки и приема |

## Подключение устройств через UART

Для связи между устройствами используется следующая схема подключения:

| ESP32       | Внешнее устройство |
|-------------|-------------------|
| TX (GPIO 1) | RX                |
| RX (GPIO 3) | TX                |
| GND         | GND               |

## Протокол MAVLink через UART

В отличие от предыдущей версии, которая использовала самописный протокол с маркерами, текущая версия использует стандартный протокол MAVLink. 

### Особенности реализации:
- MAVLink обеспечивает собственный механизм обнаружения и восстановления пакетов
- Используется встроенная контрольная сумма для проверки целостности данных
- Нет необходимости во внешних маркерах начала и конца пакета
- Поддержка различных типов сообщений (телеметрия, команды, подтверждения)

### Обработка MAVLink сообщений
1. Каждый байт, полученный через UART, передается парсеру MAVLink через функцию `mavlink_parse_byte()`
2. Когда полный пакет MAVLink распознан, вызывается зарегистрированный обработчик сообщений
3. Обработчик сообщений анализирует тип сообщения и выполняет соответствующие действия

### Поддерживаемые типы сообщений
Система распознает и обрабатывает следующие типы MAVLink сообщений:
- `HEARTBEAT` - поддержание связи и информация о состоянии системы
- `ATTITUDE` - данные об ориентации (крен, тангаж, рысканье)
- `GLOBAL_POSITION_INT` - данные о местоположении и высоте
- И другие, определенные в документации MAVLink

Более подробное описание формата сообщений и структуры данных содержится в [официальной документации MAVLink](https://mavlink.io/en/messages/).